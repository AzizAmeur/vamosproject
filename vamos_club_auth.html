<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vamos Club - Reservation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: white;
            gap: 16px;
        }
        .left-header { display: flex; align-items: center; gap: 16px; }
        .logo { height: 60px; margin-right: 20px; }
        .menu a {
            text-decoration: none;
            color: black;
            font-weight: bold;
            margin-right: 25px;
            font-family: sans-serif;
        }
        .menu a:hover { color: gray; }

        .auth-area { display:flex; align-items:center; gap:10px; }
        .pill {
            border: 1px solid #e5e7eb;
            background: #fff;
            border-radius: 999px;
            padding: 8px 12px;
            font-weight: 600;
            cursor: pointer;
        }
        .pill.primary { background:#111827; color:#fff; border-color:#111827; }
        .pill:disabled { opacity: 0.6; cursor: not-allowed; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            width: 100%;
        }

        .date-navigator {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            color: white;
        }
        .btn-prev { background: #2563eb; }
        .btn-next { background: #16a34a; }

        .court-tabs { display: flex; gap: 1rem; margin-bottom: 2rem; }
        .court-tab {
            flex: 1;
            padding: 1rem 2rem;
            border: 2px solid #3b82f6;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            background: white;
            color: #6b7280;
        }
        .court-tab.active { background: #3b82f6; color: white; }

        .calendar-container { background: white; border-radius: 0.5rem; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th { padding: 1rem; background: #f3f4f6; font-weight: 600; border-bottom: 2px solid #d1d5db; }
        .time-slot-row { background: #C5D89D; }
        .time-cell { padding: 0.75rem 1rem; color: white; font-weight: 600; }

        .cell-content { display: flex; }
        .booked-section {
            flex: 1;
            padding: 0.75rem;
            background: #e0f2fe;
            text-align: center;
            color: #0369a1;
            font-weight: 500;
        }
        .add-section { flex: 1; padding: 0.75rem; text-align: center; }
        .add-button {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            cursor: pointer;
        }
        .add-button:hover { background: #f3f4f6; }
        .invited-section {
            flex: 1;
            padding: 0.75rem;
            background: #fef3c7;
            text-align: center;
            color: #92400e;
            font-weight: 500;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 9999;
        }
        .modal.show { display: flex; }

        .modal-content {
            background: white;
            border-radius: 1rem;
            max-width: 520px;
            width: 100%;
            overflow: hidden;
        }
        .modal-header {
            background-color: #000000;
            color: white;
            padding: 1.2rem 1.5rem;
        }
        .close-button {
            float: right;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem 0.6rem;
            border-radius: 0.5rem;
        }
        .modal-body { padding: 1.5rem; }
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; font-weight: 600; margin-bottom: 0.5rem; }
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
        }
        .submit-button {
            width: 100%;
            padding: 1rem;
            background-color: rgb(198, 168, 75);
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
        }
        .submit-button.secondary { background:#111827; }
        .helper-text { font-size: 0.9rem; color:#6b7280; margin-top: 0.5rem; }
        .error-text { font-size: 0.95rem; color:#b91c1c; margin-top: 0.5rem; }
        .success-message { text-align: center; padding: 3rem; }
        .success-icon { font-size: 4rem; margin-bottom: 1rem; }

        section { display: flex; }
        section .padelimg, section .tennisimg { width: 20%; height: auto; }
        .modal-headerimg { display: flex; justify-content: space-between; align-items: center; gap: 12px; }
        .modal-headerimg img { width: 100px; height: auto; }

        /* Auth modal tabs */
        .tabs { display:flex; gap: 8px; margin-bottom: 16px; }
        .tab-btn {
            flex:1;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            background: #fff;
            border-radius: 12px;
            font-weight: 700;
            cursor:pointer;
        }
        .tab-btn.active { border-color:#111827; background:#111827; color:#fff; }
        .row { display:flex; gap: 10px; }
        .row > .form-group { flex:1; }
    </style>
</head>
<body>
    <header>
        <div class="left-header">
            <img src="vamos.png" class="logo" alt="Logo">
            <div class="menu">
                <a href="#">ACCUEIL</a>
                <a href="#">√Ä-PROPOS</a>
                <a href="#">TARIFS</a>
                <a href="#">reservation</a>
                <a href="#">CONTACT</a>
            </div>
        </div>

        <div class="auth-area">
            <span id="userBadge" class="pill" style="display:none;"></span>
            <button id="loginBtn" class="pill primary" onclick="openAuthModal('login')">Login</button>
            <button id="logoutBtn" class="pill" style="display:none;" onclick="logout()">Logout</button>
        </div>
    </header>

    <section>
        <img src="padelimage.jpg" class="padelimg" alt="">
        <div class="container">
            <!-- Date Navigator -->
            <div class="date-navigator">
                <button class="nav-button btn-prev" onclick="changeDate(-1)">‚Üê Previous</button>
                <div>
                    <div id="currentDate"></div>
                    <div id="currentDateISO"></div>
                </div>
                <button class="nav-button btn-next" onclick="changeDate(1)">Next ‚Üí</button>
            </div>

            <!-- Court Tabs -->
            <div class="court-tabs">
                <button class="court-tab active" onclick="selectCourt('padel1')">üéæ Padel Court 1</button>
                <button class="court-tab" onclick="selectCourt('padel2')">üéæ Padel Court 2</button>
                <button class="court-tab" onclick="selectCourt('tennis1')">üéæ Tennis Court</button>
            </div>

            <!-- Calendar -->
            <div class="calendar-container">
                <table>
                    <thead>
                        <tr>
                            <th style="text-align: left;">Time</th>
                            <th id="courtTitle">Padel Court 1</th>
                        </tr>
                    </thead>
                    <tbody id="calendarBody"></tbody>
                </table>
            </div>
        </div>
        <img src="tennisimage.jpg" class="tennisimg" alt="">
    </section>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal" onclick="if(event.target === this) closeModal()">
        <div class="modal-content">
            <div id="bookingForm">
                <div class="modal-header">
                    <button class="close-button" onclick="closeModal()">√ó</button>
                    <h2>Ajouter une r√©servation</h2>
                    <div class="modal-headerimg">
                        <div id="modalInfo"></div>
                        <div><img src="vamos.png" alt=""></div>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">üë§ Nom et Prenom</label>
                        <input type="text" id="nameInput" class="form-input" placeholder="Nom et Prenom">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üìû T√©l√©phone</label>
                        <input type="tel" id="phoneInput" class="form-input" placeholder="+216 12 345 678">
                    </div>
                    <div class="form-group">
                        <label class="form-label">‚úâÔ∏è Email</label>
                        <input type="email" id="emailInput" class="form-input" placeholder="vamos@example.com">
                    </div>
                    <button class="submit-button" onclick="submitBooking()">Confirmer</button>
                    <div class="helper-text">üîí You must be logged in to book. Your name/email will be used from your account.</div>
                </div>
            </div>
            <div id="successMessage" class="success-message" style="display: none;">
                <div class="success-icon">‚úÖ</div>
                <h3>R√©servation confirm√©e!</h3>
            </div>
        </div>
    </div>

    <!-- Auth Modal (Login / Signup + email code verification) -->
    <div id="authModal" class="modal" onclick="if(event.target === this) closeAuthModal()">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close-button" onclick="closeAuthModal()">√ó</button>
                <h2 id="authTitle">Account</h2>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <button id="tabLogin" class="tab-btn active" onclick="switchAuthTab('login')">Login</button>
                    <button id="tabSignup" class="tab-btn" onclick="switchAuthTab('signup')">Signup</button>
                </div>

                <!-- Login -->
                <div id="loginPanel">
                    <div class="form-group">
                        <label class="form-label">‚úâÔ∏è Email</label>
                        <input type="email" id="loginEmail" class="form-input" placeholder="you@example.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üîë Password</label>
                        <input type="password" id="loginPassword" class="form-input" placeholder="Password">
                    </div>
                    <button id="loginSubmit" class="submit-button secondary" onclick="login()">Login</button>
                    <div id="loginMsg" class="helper-text"></div>
                </div>

                <!-- Signup -->
                <div id="signupPanel" style="display:none;">
                    <div class="row">
                        <div class="form-group">
                            <label class="form-label">üë§ Name</label>
                            <input type="text" id="signupName" class="form-input" placeholder="Your name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">‚úâÔ∏è Email</label>
                            <input type="email" id="signupEmail" class="form-input" placeholder="you@example.com">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üîë Password</label>
                        <input type="password" id="signupPassword" class="form-input" placeholder="Create a password">
                    </div>

                    <button id="sendCodeBtn" class="submit-button secondary" onclick="requestSignupCode()">Send 6-digit code</button>
                    <div id="signupMsg" class="helper-text"></div>

                    <div id="verifyBox" style="display:none; margin-top: 16px;">
                        <div class="form-group">
                            <label class="form-label">‚úÖ Verification code</label>
                            <input type="text" id="signupCode" class="form-input" placeholder="6-digit code" maxlength="6" inputmode="numeric">
                            <div class="helper-text">Check your email and paste the 6-digit code here.</div>
                        </div>
                        <button id="verifyBtn" class="submit-button" onclick="verifySignupCode()">Verify & Create account</button>
                        <div id="verifyMsg" class="helper-text"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === VARIABLES ===
        let currentDate = new Date();
        let bookings = {};
        let selectedSlot = null;
        let currentCourt = 'padel1';

        let currentUser = null; // { name, email }

        // Time slots
        const padelSlots = ['08:00 - 09:30', '09:30 - 11:00', '11:00 - 12:30', '12:30 - 14:00', '14:00 - 15:30', '15:30 - 17:00', '17:00 - 18:30', '18:30 - 20:00', '20:00 - 21:30', '21:30 - 23:00', '23:00 - 00:00'];
        const tennisSlots = ['08:00 - 10:00', '10:00 - 12:00', '12:00 - 14:00', '14:00 - 16:00', '16:00 - 18:00', '18:00 - 20:00', '20:00 - 22:00', '22:00 - 00:00'];

        const courtNames = {
            'padel1': 'Padel Court 1',
            'padel2': 'Padel Court 2',
            'tennis1': 'Tennis Court'
        };

        // === N8N WEBHOOKS ===
        // bookings (already in your code)
        const N8N_LOAD_BOOKINGS_URL = 'http://localhost:5678/webhook/load-court-bookings';
        const N8N_SAVE_BOOKING_URL = 'http://localhost:5678/webhook/court-bookings';

        // auth (new)
        const N8N_AUTH_REQUEST_CODE_URL = 'http://localhost:5678/webhook/auth-request-code';
        const N8N_AUTH_VERIFY_URL = 'http://localhost:5678/webhook/auth-verify';
        const N8N_AUTH_LOGIN_URL = 'http://localhost:5678/webhook/auth-login';

        // === AUTH HELPERS ===
        function loadUserFromStorage() {
            try {
                const raw = localStorage.getItem('vamos_user');
                currentUser = raw ? JSON.parse(raw) : null;
            } catch (e) {
                currentUser = null;
            }
            updateAuthUI();
        }

        function saveUserToStorage(user) {
            currentUser = user;
            localStorage.setItem('vamos_user', JSON.stringify(user));
            updateAuthUI();
        }

        function logout() {
            localStorage.removeItem('vamos_user');
            currentUser = null;
            updateAuthUI();
        }

        function updateAuthUI() {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const badge = document.getElementById('userBadge');

            if (currentUser && currentUser.email) {
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
                badge.style.display = 'inline-block';
                badge.textContent = `üë§ ${currentUser.name || 'User'} (${currentUser.email})`;
            } else {
                loginBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
                badge.style.display = 'none';
                badge.textContent = '';
            }
        }

        function requireLoginOrOpenAuth() {
            if (currentUser && currentUser.email) return true;
            openAuthModal('login');
            return false;
        }

        // === AUTH MODAL UI ===
        function openAuthModal(tab = 'login') {
            switchAuthTab(tab);
            document.getElementById('authModal').classList.add('show');
        }
        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('show');
        }
        function switchAuthTab(tab) {
            const tabLogin = document.getElementById('tabLogin');
            const tabSignup = document.getElementById('tabSignup');
            const loginPanel = document.getElementById('loginPanel');
            const signupPanel = document.getElementById('signupPanel');
            const authTitle = document.getElementById('authTitle');

            if (tab === 'signup') {
                tabSignup.classList.add('active'); tabLogin.classList.remove('active');
                signupPanel.style.display = 'block'; loginPanel.style.display = 'none';
                authTitle.textContent = 'Create account';
            } else {
                tabLogin.classList.add('active'); tabSignup.classList.remove('active');
                loginPanel.style.display = 'block'; signupPanel.style.display = 'none';
                authTitle.textContent = 'Login';
            }

            // clear messages
            document.getElementById('loginMsg').textContent = '';
            document.getElementById('signupMsg').textContent = '';
            document.getElementById('verifyMsg').textContent = '';
        }

        function setMsg(elId, msg, isError = false) {
            const el = document.getElementById(elId);
            el.className = isError ? 'error-text' : 'helper-text';
            el.textContent = msg || '';
        }

        // === AUTH ACTIONS ===
        async function requestSignupCode() {
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;

            if (!name) return setMsg('signupMsg', 'Please enter your name.', true);
            if (!email) return setMsg('signupMsg', 'Please enter your email.', true);
            if (!password || password.length < 6) return setMsg('signupMsg', 'Password must be at least 6 characters.', true);

            setMsg('signupMsg', 'Sending code...');
            document.getElementById('sendCodeBtn').disabled = true;

            try {
                const res = await fetch(N8N_AUTH_REQUEST_CODE_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });
                const data = await res.json();
                if (!res.ok || !data.success) {
                    throw new Error(data.message || 'Failed to send code');
                }
                setMsg('signupMsg', 'Code sent ‚úÖ. Check your email.');
                document.getElementById('verifyBox').style.display = 'block';
            } catch (err) {
                console.error(err);
                setMsg('signupMsg', err.message || 'Error sending code.', true);
            } finally {
                document.getElementById('sendCodeBtn').disabled = false;
            }
        }

        async function verifySignupCode() {
            const email = document.getElementById('signupEmail').value.trim();
            const code = document.getElementById('signupCode').value.trim();

            if (!email) return setMsg('verifyMsg', 'Missing email.', true);
            if (!code || code.length !== 6) return setMsg('verifyMsg', 'Please enter the 6-digit code.', true);

            setMsg('verifyMsg', 'Verifying...');
            document.getElementById('verifyBtn').disabled = true;

            try {
                const res = await fetch(N8N_AUTH_VERIFY_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, code })
                });
                const data = await res.json();
                if (!res.ok || !data.success) {
                    throw new Error(data.message || 'Verification failed');
                }
                // login user after signup
                saveUserToStorage({ name: data.user?.name || document.getElementById('signupName').value.trim(), email });
                setMsg('verifyMsg', 'Account created ‚úÖ');
                setTimeout(() => closeAuthModal(), 600);
            } catch (err) {
                console.error(err);
                setMsg('verifyMsg', err.message || 'Error verifying code.', true);
            } finally {
                document.getElementById('verifyBtn').disabled = false;
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email) return setMsg('loginMsg', 'Please enter your email.', true);
            if (!password) return setMsg('loginMsg', 'Please enter your password.', true);

            setMsg('loginMsg', 'Logging in...');
            document.getElementById('loginSubmit').disabled = true;

            try {
                const res = await fetch(N8N_AUTH_LOGIN_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();
                if (!res.ok || !data.success) {
                    throw new Error(data.message || 'Login failed');
                }
                saveUserToStorage({ name: data.user?.name || 'User', email });
                setMsg('loginMsg', 'Login successful ‚úÖ');
                setTimeout(() => closeAuthModal(), 500);
            } catch (err) {
                console.error(err);
                setMsg('loginMsg', err.message || 'Login error.', true);
            } finally {
                document.getElementById('loginSubmit').disabled = false;
            }
        }

        // === LOAD BOOKINGS FROM GOOGLE SHEETS (via n8n) ===
        async function loadBookingsFromCalendar() {
            if (N8N_LOAD_BOOKINGS_URL === 'YOUR_N8N_LOAD_WEBHOOK_URL') {
                console.log('n8n not configured - using local bookings only');
                renderCalendar();
                return;
            }

            try {
                const response = await fetch(N8N_LOAD_BOOKINGS_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ date: getISODate(currentDate) })
                });

                const data = await response.json();

                // Clear existing bookings for this date
                Object.keys(bookings).forEach(key => {
                    if (key.startsWith(getISODate(currentDate))) delete bookings[key];
                });

                if (data.bookings && Array.isArray(data.bookings)) {
                    data.bookings.forEach(booking => {
                        const key = `${booking.date}_${booking.time}_${booking.courtId}`;
                        bookings[key] = booking.name;
                    });
                }

                renderCalendar();
            } catch (error) {
                console.error('Error loading bookings:', error);
                renderCalendar();
            }
        }

        // === DATE FUNCTIONS ===
        function formatDate(date) {
            return date.toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }
        function getISODate(date) { return date.toISOString().split('T')[0]; }
        function updateDateDisplay() {
            document.getElementById('currentDate').textContent = formatDate(currentDate);
            document.getElementById('currentDateISO').textContent = getISODate(currentDate);
        }
        function changeDate(days) {
            currentDate.setDate(currentDate.getDate() + days);
            updateDateDisplay();
            loadBookingsFromCalendar();
        }

        // === COURT FUNCTIONS ===
        function selectCourt(court) {
            currentCourt = court;
            const tabs = document.querySelectorAll('.court-tab');
            tabs.forEach((tab, i) => {
                tab.classList.remove('active');
                if ((i === 0 && court === 'padel1') || (i === 1 && court === 'padel2') || (i === 2 && court === 'tennis1')) {
                    tab.classList.add('active');
                }
            });
            document.getElementById('courtTitle').textContent = courtNames[court];
            renderCalendar();
        }

        // === CALENDAR FUNCTIONS ===
        function isSlotBooked(time) {
            const key = `${getISODate(currentDate)}_${time}_${currentCourt}`;
            return bookings[key];
        }

        function renderCalendar() {
            const tbody = document.getElementById('calendarBody');
            tbody.innerHTML = '';
            const slots = currentCourt === 'tennis1' ? tennisSlots : padelSlots;

            slots.forEach(time => {
                const timeRow = tbody.insertRow();
                timeRow.className = 'time-slot-row';
                const timeCell = timeRow.insertCell();
                timeCell.className = 'time-cell';
                timeCell.textContent = time;
                timeCell.colSpan = 2;

                const bookingRow = tbody.insertRow();
                bookingRow.insertCell();

                const cell = bookingRow.insertCell();
                const content = document.createElement('div');
                content.className = 'cell-content';

                const bookedBy = isSlotBooked(time);

                if (bookedBy) {
                    content.innerHTML = `<div class="booked-section">${bookedBy}</div><div class="invited-section">üë§ Invit√©</div>`;
                } else {
                    content.innerHTML = `<div class="booked-section" style="background: transparent;"></div><div class="add-section"><button class="add-button" onclick="openModal('${time}')">‚ûï Ajouter</button></div>`;
                }

                cell.appendChild(content);
            });
        }

        // === MODAL FUNCTIONS ===
        function openModal(time) {
            if (!requireLoginOrOpenAuth()) return;

            selectedSlot = { time, court: currentCourt };
            document.getElementById('modalInfo').innerHTML = `<p>üìÖ ${formatDate(currentDate)}</p><p>‚è∞ ${time}</p><p>üéæ ${courtNames[currentCourt]}</p>`;

            // prefill from account and lock name/email to prevent fake values
            document.getElementById('nameInput').value = currentUser?.name || '';
            document.getElementById('emailInput').value = currentUser?.email || '';
            document.getElementById('nameInput').readOnly = true;
            document.getElementById('emailInput').readOnly = true;

            document.getElementById('phoneInput').value = '';
            document.getElementById('bookingForm').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('bookingModal').classList.add('show');
        }

        function closeModal() { document.getElementById('bookingModal').classList.remove('show'); }

        // === BOOKING FUNCTION ===
        function submitBooking() {
            if (!requireLoginOrOpenAuth()) return;

            const name = document.getElementById('nameInput').value.trim();
            const phone = document.getElementById('phoneInput').value.trim();
            const email = document.getElementById('emailInput').value.trim();

            if (!phone) { alert('Veuillez saisir votre num√©ro de t√©l√©phone.'); return; }

            const bookingData = {
                date: getISODate(currentDate),
                time: selectedSlot.time,
                court: courtNames[selectedSlot.court],
                courtId: selectedSlot.court,
                name, phone, email,
                timestamp: new Date().toISOString()
            };

            fetch(N8N_SAVE_BOOKING_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(bookingData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Saved to Google Sheets:', data);

                const key = `${bookingData.date}_${bookingData.time}_${selectedSlot.court}`;
                bookings[key] = name;

                document.getElementById('bookingForm').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                renderCalendar();
                setTimeout(closeModal, 2000);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Erreur lors de la r√©servation. Veuillez r√©essayer.');
            });
        }

        // === INITIALIZE ===
        updateDateDisplay();
        loadBookingsFromCalendar();
        loadUserFromStorage();
    </script>
</body>
</html>
